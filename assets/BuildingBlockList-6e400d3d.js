import{s as Ie,V as q,m as Ae,a as Le,u as Me,b as ue,c as Oe,d as Pe,e as X,f as Re,g as me,h as Te,i as De,B as Ee}from"./BuildingBlock-713cfea2.js";import{_ as ee,J as h,M as F,L as u,W as V,P as M,O,p as Ke,c as L,r as B,X as je,Y as ve,Z as ke,$ as Ue,n as Ne,a0 as ze,a1 as He,u as ne,w as ge,q as s,F as G,s as N,A as he,E as re,G as Q,a2 as Qe,H as Z,S as C,K as P,a3 as _e,Q as oe,V as Ge}from"./index-d6c6ba90.js";import{R as Je}from"./RegisterLoadingProgress-333c8945.js";import{g as We,b as Xe,c as $,h as Ye,V as z,f as ce,i as Ze,d as $e,e as qe}from"./VList-81e2ee0b.js";import{q as et,r as tt,u as lt,s as st,v as de,o as at,j as it,k as be,l as nt}from"./VContainer-654d4238.js";import{a as H,V as Y}from"./VRow-32e8d21a.js";import"./_commonjsHelpers-725317a4.js";import"./VToolbar-c71a4682.js";import"./VTooltip-3d022f43.js";const ut={props:{status:String,variant:{type:String,default:"flat"},size:{type:String,default:"small"}},computed:{color(){return Ie[this.status]||null},label(){return this.status.charAt(0).toUpperCase()+this.status.substring(1).replaceAll("-"," ")}}};function rt(t,l,e,c,i,n){return e.status?(h(),F(q,{key:0,variant:e.variant,color:n.color,size:e.size},{default:u(()=>[V(M(n.label),1)]),_:1},8,["variant","color","size"])):O("",!0)}const pe=ee(ut,[["render",rt]]);const ot=(t,l,e)=>t==null||l==null?-1:t.toString().toLocaleLowerCase().indexOf(l.toString().toLocaleLowerCase()),ct=Ke({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function dt(t,l,e){var _;const c=[],i=(e==null?void 0:e.default)??ot,n=e!=null&&e.filterKeys?ke(e.filterKeys):!1,f=Object.keys((e==null?void 0:e.customKeyFilter)??{}).length;if(!(t!=null&&t.length))return c;e:for(let r=0;r<t.length;r++){const d=t[r],o={},S={};let b=-1;if(l&&!(e!=null&&e.noFilter)){if(typeof d=="object"){const te=n||Object.keys(d);for(const T of te){const k=Ue(d,T,d),p=(_=e==null?void 0:e.customKeyFilter)==null?void 0:_[T];if(b=p?p(k,l,d):i(k,l,d),b!==-1&&b!==!1)p?o[T]=b:S[T]=b;else if((e==null?void 0:e.filterMode)==="every")continue e}}else b=i(d,l,d),b!==-1&&b!==!1&&(S.title=b);const I=Object.keys(S).length,E=Object.keys(o).length;if(!I&&!E||(e==null?void 0:e.filterMode)==="union"&&E!==f&&!I||(e==null?void 0:e.filterMode)==="intersection"&&(E!==f||!I))continue}c.push({index:r,matches:{...S,...o}})}return c}function ft(t,l,e,c){const i=L(()=>typeof(e==null?void 0:e.value)!="string"&&typeof(e==null?void 0:e.value)!="number"?"":String(e.value)),n=B([]),f=B(new Map);je(()=>{n.value=[],f.value=new Map;const r=ve(l);dt(r,i.value,{customKeyFilter:t.customKeyFilter,default:t.customFilter,filterKeys:ve(c==null?void 0:c.filterKeys)??t.filterKeys,filterMode:t.filterMode,noFilter:t.noFilter}).forEach(o=>{let{index:S,matches:b}=o;const I=r[S];n.value.push(I),f.value.set(I.value,b)})});function _(r){return f.value.get(r.value)}return{filteredItems:n,filteredMatches:f,getMatches:_}}function mt(t,l,e){if(l==null)return t;if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return typeof l=="number"&&~l?s(G,null,[s("span",{class:"v-autocomplete__unmask"},[t.substr(0,l)]),s("span",{class:"v-autocomplete__mask"},[t.substr(l,e)]),s("span",{class:"v-autocomplete__unmask"},[t.substr(l+e)])]):t}const vt=Ne()({name:"VAutocomplete",props:{search:String,...ct({filterKeys:["title"]}),...Ae(),...ze(Le({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...et({transition:!1})},emits:{"update:focused":t=>!0,"update:search":t=>!0,"update:modelValue":t=>!0,"update:menu":t=>!0},setup(t,l){let{slots:e}=l;const{t:c}=He(),i=B(),n=B(!1),f=B(!0),_=B(),r=ne(t,"menu"),d=L({get:()=>r.value,set:a=>{var m;r.value&&!a&&((m=_.value)!=null&&m.ΨopenChildren)||(r.value=a)}}),o=B(-1),S=L(()=>{var a;return(a=i.value)==null?void 0:a.color}),{items:b,transformIn:I,transformOut:E}=We(t),{textColorClasses:te,textColorStyles:T}=tt(S),k=ne(t,"search",""),p=ne(t,"modelValue",[],a=>I(ke(a)),a=>{const m=E(a);return t.multiple?m:m[0]??null}),D=Me(),{filteredItems:le,getMatches:ye}=ft(t,b,L(()=>f.value?void 0:k.value)),A=L(()=>p.value.map(a=>b.value.find(m=>t.valueComparator(m.value,a.value))||a)),se=L(()=>t.hideSelected?le.value.filter(a=>!A.value.some(m=>m.value===a.value)):le.value),ae=L(()=>A.value.map(a=>a.props.value)),fe=L(()=>A.value[o.value]),ie=B();function Ve(a){t.openOnClear&&(d.value=!0),k.value=""}function xe(){t.hideNoData&&!b.value.length||t.readonly||D!=null&&D.isReadonly.value||(d.value=!0)}function Fe(a){var J,v,x,R;if(t.readonly||D!=null&&D.isReadonly.value)return;const m=i.value.selectionStart,y=ae.value.length;if((o.value>-1||["Enter","ArrowDown","ArrowUp"].includes(a.key))&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(d.value=!0),["Escape"].includes(a.key)&&(d.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(f.value=!0),a.key==="ArrowDown"?(J=ie.value)==null||J.focus("next"):a.key==="ArrowUp"&&((v=ie.value)==null||v.focus("prev")),!!t.multiple){if(["Backspace","Delete"].includes(a.key)){if(o.value<0){a.key==="Backspace"&&!k.value&&(o.value=y-1);return}const g=o.value;fe.value&&j(fe.value),o.value=g>=y-1?y-2:g}if(a.key==="ArrowLeft"){if(o.value<0&&m>0)return;const g=o.value>-1?o.value-1:y-1;A.value[g]?o.value=g:(o.value=-1,i.value.setSelectionRange((x=k.value)==null?void 0:x.length,(R=k.value)==null?void 0:R.length))}if(a.key==="ArrowRight"){if(o.value<0)return;const g=o.value+1;A.value[g]?o.value=g:(o.value=-1,i.value.setSelectionRange(0,0))}}}function Ce(a){k.value=a.target.value}function we(){n.value&&(f.value=!0)}function Be(a){n.value=!0}function Se(a){var m;a.relatedTarget==null&&((m=i.value)==null||m.focus())}const K=B(!1);function j(a){if(t.multiple){const m=ae.value.findIndex(y=>t.valueComparator(y,a.value));if(m===-1)p.value=[...p.value,a];else{const y=[...p.value];y.splice(m,1),p.value=y}}else p.value=[a],K.value=!0,e.selection||(k.value=a.title),d.value=!1,f.value=!0,he(()=>K.value=!1)}return ge(n,a=>{var m;a?(K.value=!0,k.value=t.multiple||e.selection?"":String(((m=A.value.at(-1))==null?void 0:m.props.title)??""),f.value=!0,he(()=>K.value=!1)):(d.value=!1,k.value="")}),ge(k,a=>{!n.value||K.value||(a&&(d.value=!0),f.value=!a)}),lt(()=>{const a=!!(t.chips||e.chip),m=!!(!t.hideNoData||se.value.length||e.prepend||e.append||e["no-data"]),y=p.value.length>0,[J]=ue.filterProps(t);return s(ue,N({ref:i},J,{modelValue:k.value,"onUpdate:modelValue":v=>{v==null&&(p.value=[])},focused:n.value,"onUpdate:focused":v=>n.value=v,validationValue:p.externalValue,dirty:y,onInput:Ce,class:["v-autocomplete",{"v-autocomplete--active-menu":d.value,"v-autocomplete--chips":!!t.chips,"v-autocomplete--selecting-index":o.value>-1,[`v-autocomplete--${t.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!e.selection},t.class],style:t.style,appendInnerIcon:t.menuIcon,readonly:t.readonly,placeholder:y?void 0:t.placeholder,"onClick:clear":Ve,"onMousedown:control":xe,onKeydown:Fe}),{...e,default:()=>s(G,null,[s(Oe,N({ref:_,modelValue:d.value,"onUpdate:modelValue":v=>d.value=v,activator:"parent",contentClass:"v-autocomplete__content",eager:t.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:t.transition,onAfterLeave:we},t.menuProps),{default:()=>[m&&s(Xe,{ref:ie,selected:ae.value,selectStrategy:t.multiple?"independent":"single-independent",onMousedown:v=>v.preventDefault(),onFocusin:Be,onFocusout:Se},{default:()=>{var v,x,R;return[!se.value.length&&!t.hideNoData&&(((v=e["no-data"])==null?void 0:v.call(e))??s($,{title:c(t.noDataText)},null)),(x=e["prepend-item"])==null?void 0:x.call(e),se.value.map(g=>{var U;return((U=e.item)==null?void 0:U.call(e,{item:g,props:N(g.props,{onClick:()=>j(g)})}))??s($,N({key:g.value},g.props,{onClick:()=>j(g)}),{prepend:w=>{let{isSelected:W}=w;return t.multiple&&!t.hideSelected?s(Pe,{modelValue:W,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var w,W;return f.value?g.title:mt(g.title,(w=ye(g))==null?void 0:w.title,((W=k.value)==null?void 0:W.length)??0)}})}),(R=e["append-item"])==null?void 0:R.call(e)]}})]}),A.value.map((v,x)=>{var U;function R(w){w.stopPropagation(),w.preventDefault(),j(v)}const g={"onClick:close":R,modelValue:!0,"onUpdate:modelValue":void 0};return s("div",{key:v.value,class:["v-autocomplete__selection",x===o.value&&["v-autocomplete__selection--selected",te.value]],style:x===o.value?T.value:{}},[a?e.chip?s(st,{key:"chip-defaults",defaults:{VChip:{closable:t.closableChips,size:"small",text:v.title}}},{default:()=>{var w;return[(w=e.chip)==null?void 0:w.call(e,{item:v,index:x,props:g})]}}):s(q,N({key:"chip",closable:t.closableChips,size:"small",text:v.title},g),null):((U=e.selection)==null?void 0:U.call(e,{item:v,index:x}))??s("span",{class:"v-autocomplete__selection-text"},[v.title,t.multiple&&x<A.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[V(",")])])])})])})}),Ye({isFocused:n,isPristine:f,menu:d,search:k,filteredItems:le,select:j},i)}}),gt={components:{StatusChip:pe},props:{defaultStatuses:{type:Array,default:X.map(t=>t.value)}},data(){return{loading:!1,textFilter:"",statuses:X,activeStatuses:null,statusFilter:[],registers:[],registerFilter:[],expanded:!1,noAnimate:!0,tags:null,tagFilter:[]}},mounted(){this.loading=!0,re.config.showImported&&Q.getRegisters(!0).then(t=>{Object.keys(t).length>1?(this.registers=Object.values(t).filter(Q.isShown).sort((l,e)=>l.local!==e.local?l.local?-1:1:l.name.localeCompare(e.name)).map(l=>({name:l.name,url:l.url,color:l.color})),this.registerFilter=this.registers.map(l=>l.url)):(this.registers=[],this.registerFilter=null)}),Q.getBBlocks(re.config.showImported).then(t=>{const l=new Set,e={};Object.values(t).forEach(c=>{var i;l.add(c.status),(i=c.tags)==null||i.forEach(n=>{n=n.trim().toLowerCase(),e[n]=e[n]?e[n]+1:1})}),this.tags=Object.keys(e).sort(),this.activeStatuses=X.filter(c=>l.has(c.value)),this.defaultStatuses&&(this.statusFilter=this.defaultStatuses.filter(c=>l.has(c)))}).finally(()=>this.loading=!1),this.expanded=this.$vuetify.display.mdAndUp?"expanded":null,setTimeout(()=>this.noAnimate=!1,350),this.debouncedTextFilter=Qe(t=>{this.emitFilter()},300),this.emitFilter()},methods:{selectAllStatuses(){this.statusFilter=X.map(t=>t.value)},selectOnlyStable(){this.statusFilter=["stable"]},selectRegisters(t){t?this.registerFilter=this.registers.map(l=>l.url):this.registerFilter.length=0},reset(){this.textFilter="",this.statusFilter=this.defaultStatuses.slice(),this.selectRegisters(!0)},emitFilter(){this.$emit("filter-change",{text:this.textFilter,registers:this.registers.length?this.registerFilter:null,status:this.statusFilter,tags:this.tagFilter})}},watch:{registerFilter(){this.emitFilter()},statusFilter(){this.emitFilter()},textFilter(t){this.debouncedTextFilter(t)},tagFilter(){this.emitFilter()},defaultStatuses(){this.statusFilter=this.defaultStatuses.slice()}}},ht={class:"flex-grow-1 mx-2 filter-text mb-1"},_t={key:0,class:"mx-2 filter-status mb-1"},kt={key:1,class:"mx-2 filter-registers mb-1"},bt={key:2,class:"mx-2 filter-tags mb-1"},pt={class:"mx-2 d-flex align-center filter-reset"};function yt(t,l,e,c,i,n){const f=Z("status-chip");return h(),F(De,{modelValue:i.expanded,"onUpdate:modelValue":l[6]||(l[6]=_=>i.expanded=_),class:_e({"no-animate":i.noAnimate})},{default:u(()=>[s(Te,{title:"Filters",value:"expanded",eager:""},{default:u(()=>[s(Re,null,{default:u(()=>{var _;return[C("div",{class:_e(["d-flex flex-wrap filter-wrapper justify-end",t.$vuetify.display.mdAndUp?"size-md":""])},[C("div",ht,[s(ue,{label:"Name or identifier",modelValue:i.textFilter,"onUpdate:modelValue":l[0]||(l[0]=r=>i.textFilter=r),"hide-details":"auto",clearable:""},null,8,["modelValue"])]),i.activeStatuses?(h(),P("div",_t,[s(me,{label:"Status","item-title":"label",items:i.activeStatuses,multiple:"",modelValue:i.statusFilter,"onUpdate:modelValue":l[1]||(l[1]=r=>i.statusFilter=r),"hide-details":"auto"},{"prepend-item":u(()=>[s($,{class:"all-none"},{default:u(()=>[s(z,{variant:"text",onClick:n.selectAllStatuses},{default:u(()=>[V("All")]),_:1},8,["onClick"]),s(z,{variant:"text",onClick:n.selectOnlyStable},{default:u(()=>[V("Only stable")]),_:1},8,["onClick"])]),_:1})]),selection:u(({item:r})=>[s(f,{status:r.value,class:"mb-1"},null,8,["status"])]),_:1},8,["items","modelValue"])])):O("",!0),i.registers.length>1?(h(),P("div",kt,[s(me,{label:"Registers",items:i.registers,multiple:"",modelValue:i.registerFilter,"onUpdate:modelValue":l[4]||(l[4]=r=>i.registerFilter=r),"item-title":"name","item-value":"url","hide-details":"auto"},{"prepend-item":u(()=>[s($,{class:"all-none"},{default:u(()=>[s(z,{variant:"text",onClick:l[2]||(l[2]=r=>n.selectRegisters(!0))},{default:u(()=>[V("All")]),_:1}),s(z,{variant:"text",onClick:l[3]||(l[3]=r=>n.selectRegisters(!1))},{default:u(()=>[V("None")]),_:1})]),_:1})]),selection:u(({item:r})=>[r.raw?(h(),F(q,{key:0,size:"small",variant:"flat",color:r.raw.color,class:"mb-1"},{default:u(()=>[V(M(r.title),1)]),_:2},1032,["color"])):O("",!0)]),_:1},8,["items","modelValue"])])):O("",!0),(_=i.tags)!=null&&_.length?(h(),P("div",bt,[s(vt,{label:"Tags",items:i.tags,multiple:"",modelValue:i.tagFilter,"onUpdate:modelValue":l[5]||(l[5]=r=>i.tagFilter=r),"hide-details":"auto",clearable:""},null,8,["items","modelValue"])])):O("",!0),s(ce),C("div",pt,[s(ce),s(z,{onClick:n.reset,block:t.$vuetify.display.smAndDown},{default:u(()=>[V("Reset")]),_:1},8,["onClick","block"])])],2)]}),_:1})]),_:1})]),_:1},8,["modelValue","class"])}const Vt=ee(gt,[["render",yt]]),xt={components:{StatusChip:pe},props:{bblock:{type:Object,required:!0}},methods:{trim(t,l,e="…"){return!t||t.length<=l?t:`${t.substr(0,l-1)}${e}`}}},Ft={class:"abstract"},Ct={class:"bblock-bottom mb-2 ml-2"},wt={key:0,class:"tags mb-2 ml-2"},Bt=C("span",{class:"tags-title mr-1 mb-1 text-caption"},"Tags:",-1),St=["textContent"];function It(t,l,e,c,i,n){const f=Z("status-chip");return h(),F(be,{class:"fill-height d-flex flex-column building-block"},{default:u(()=>{var _;return[s(de,{class:"d-flex pb-0 bblock-name"},{default:u(()=>[C("div",null,[V(M(e.bblock.name)+" ",1),C("small",null,"v"+M(e.bblock.version),1)]),s(ce),s(f,{status:e.bblock.status},null,8,["status"])]),_:1}),s(at,{class:"text-caption"},{default:u(()=>[C("code",null,M(e.bblock.itemIdentifier),1)]),_:1}),s(it,null,{default:u(()=>[C("div",Ft,M(n.trim(e.bblock.abstract,200)),1)]),_:1}),C("div",Ct,[(_=e.bblock.tags)!=null&&_.length?(h(),P("div",wt,[Bt,(h(!0),P(G,null,oe(e.bblock.tags,r=>(h(),P("span",{class:"tag mr-1 mb-1 text-caption",textContent:M(r)},null,8,St))),256))])):O("",!0),C("div",null,[s(q,{variant:"flat",color:e.bblock.register.color,title:e.bblock.register.url},{default:u(()=>[V(M(e.bblock.register.name),1)]),_:1},8,["color","title"])])])]}),_:1})}const At=ee(xt,[["render",It]]);const Lt={components:{BuildingBlockListItem:At,BuildingBlockFilters:Vt,RegisterLoadingProgress:Je,BuildingBlock:Ee},data(){return{loading:!1,buildingBlocks:null,bblockDialog:!1,bblockView:null,registerProgress:{completed:0,total:0},showRegisterLoadingProgress:!1,filterValues:null}},mounted(){this.loading=!0,Q.getBBlocks(re.config.showImported).then(t=>{this.buildingBlocks=Object.values(t).filter(Q.isShown).sort((l,e)=>{const c=l.itemIdentifier.toLowerCase(),i=e.itemIdentifier.toLowerCase();return c<i?-1:c>i?1:0})}).finally(()=>{this.loading=!1})},methods:{interceptLinks:Ge,openUrl(t){window.open(t)},isVisible(t){var l,e;if(this.filterValues.text){const c=this.filterValues.text.trim().toLowerCase();if(t.itemIdentifier.toLowerCase().indexOf(c)<0&&t.name.toLowerCase().indexOf(c)<0)return!1}return!(!this.filterValues.status.includes(t.status)||this.filterValues.registers!==null&&!this.filterValues.registers.includes(t.register.url)||(l=this.filterValues.tags)!=null&&l.length&&!((e=t.tags)!=null&&e.some(c=>this.filterValues.tags.includes(c))))}},computed:{filteredBuildingBlocks(){if(!this.filterValues||!this.buildingBlocks)return[];const t=[],l=[];return this.buildingBlocks.forEach(e=>{this.isVisible(e)&&(e.highlighted?t:l).push(e)}),{highlighted:t,nonHighlighted:l}}}},Mt=C("h2",null,"Highlighted Building Blocks",-1);function Ot(t,l,e,c,i,n){const f=Z("building-block-filters"),_=Z("building-block-list-item");return h(),F(nt,{class:"bblock-list"},{default:u(()=>{var r,d;return[s(Y,null,{default:u(()=>[s(H,null,{default:u(()=>[s(f,{onFilterChange:l[0]||(l[0]=o=>this.filterValues=o)})]),_:1})]),_:1}),(d=(r=n.filteredBuildingBlocks)==null?void 0:r.highlighted)!=null&&d.length?(h(),F(Y,{key:0,align:"stretch"},{default:u(()=>[s(H,{cols:"12"},{default:u(()=>[Mt]),_:1}),(h(!0),P(G,null,oe(n.filteredBuildingBlocks.highlighted,o=>(h(),F(H,{key:o.itemIdentifier,md:"6"},{default:u(()=>[s(_,{bblock:o,to:{name:"BuildingBlock",params:{id:o.itemIdentifier}},class:"highlighted-bblock"},null,8,["bblock","to"])]),_:2},1024))),128)),s(Ze)]),_:1})):O("",!0),s(Y,{align:"stretch"},{default:u(()=>[(h(!0),P(G,null,oe(n.filteredBuildingBlocks.nonHighlighted,o=>(h(),F(H,{key:o.itemIdentifier,md:"6"},{default:u(()=>[s(_,{bblock:o,to:{name:"BuildingBlock",params:{id:o.itemIdentifier}}},null,8,["bblock","to"])]),_:2},1024))),128))]),_:1}),i.buildingBlocks&&!n.filteredBuildingBlocks.nonHighlighted.length&&!n.filteredBuildingBlocks.highlighted.length?(h(),F(Y,{key:1},{default:u(()=>[s(H,null,{default:u(()=>[s(be,null,{default:u(()=>[i.buildingBlocks.length?(h(),F(de,{key:0},{default:u(()=>[V("No building blocks match the current filters")]),_:1})):(h(),F(de,{key:1},{default:u(()=>[V("No building blocks were found in the register.")]),_:1}))]),_:1})]),_:1})]),_:1})):O("",!0),s(qe,{"model-value":i.loading,class:"align-center justify-center"},{default:u(()=>[s($e,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"])]}),_:1})}const zt=ee(Lt,[["render",Ot]]);export{zt as default};
