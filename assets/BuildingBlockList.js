import{s as Ie,V as q,m as Ae,a as Le,u as Oe,b as ue,c as Re,d as Me,e as J,f as Pe,g as me,h as Te,i as De,B as Ke}from"./BuildingBlock.js";import{_ as ee,c as re,b as Q,d as Ue,i as je}from"./index.js";import{R as Ee}from"./RegisterLoadingProgress.js";import{o as h,c as F,P as u,Z as V,S as O,R,p as Ne,h as L,g as B,_ as ze,$ as ve,a0 as ke,a1 as He,n as Qe,a2 as Ye,a3 as Ze,u as ne,w as ge,v as Ge,x as a,N as Y,y as N,K as he,r as X,Y as C,O as M,a4 as _e,U as oe}from"./vendor.js";import{f as Je,a as We,b as $,g as Xe,V as z,e as ce,h as $e,c as qe,d as et}from"./VList.js";import{o as tt,p as lt,q as at,r as de,l as st,h as it,i as be,j as nt}from"./VContainer.js";import{a as H,V as W}from"./VRow.js";import"./_commonjsHelpers.js";import"./VToolbar.js";import"./VTooltip.js";const ut={props:{status:String,variant:{type:String,default:"flat"},size:{type:String,default:"small"}},computed:{color(){return Ie[this.status]||null},label(){return this.status.charAt(0).toUpperCase()+this.status.substring(1).replaceAll("-"," ")}}};function rt(t,l,e,c,i,n){return e.status?(h(),F(q,{key:0,variant:e.variant,color:n.color,size:e.size},{default:u(()=>[V(O(n.label),1)]),_:1},8,["variant","color","size"])):R("",!0)}const pe=ee(ut,[["render",rt]]);const ot=(t,l,e)=>t==null||l==null?-1:t.toString().toLocaleLowerCase().indexOf(l.toString().toLocaleLowerCase()),ct=Ne({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function dt(t,l,e){var _;const c=[],i=(e==null?void 0:e.default)??ot,n=e!=null&&e.filterKeys?ke(e.filterKeys):!1,f=Object.keys((e==null?void 0:e.customKeyFilter)??{}).length;if(!(t!=null&&t.length))return c;e:for(let r=0;r<t.length;r++){const d=t[r],o={},S={};let b=-1;if(l&&!(e!=null&&e.noFilter)){if(typeof d=="object"){const te=n||Object.keys(d);for(const T of te){const k=He(d,T,d),p=(_=e==null?void 0:e.customKeyFilter)==null?void 0:_[T];if(b=p?p(k,l,d):i(k,l,d),b!==-1&&b!==!1)p?o[T]=b:S[T]=b;else if((e==null?void 0:e.filterMode)==="every")continue e}}else b=i(d,l,d),b!==-1&&b!==!1&&(S.title=b);const I=Object.keys(S).length,K=Object.keys(o).length;if(!I&&!K||(e==null?void 0:e.filterMode)==="union"&&K!==f&&!I||(e==null?void 0:e.filterMode)==="intersection"&&(K!==f||!I))continue}c.push({index:r,matches:{...S,...o}})}return c}function ft(t,l,e,c){const i=L(()=>typeof(e==null?void 0:e.value)!="string"&&typeof(e==null?void 0:e.value)!="number"?"":String(e.value)),n=B([]),f=B(new Map);ze(()=>{n.value=[],f.value=new Map;const r=ve(l);dt(r,i.value,{customKeyFilter:t.customKeyFilter,default:t.customFilter,filterKeys:ve(c==null?void 0:c.filterKeys)??t.filterKeys,filterMode:t.filterMode,noFilter:t.noFilter}).forEach(o=>{let{index:S,matches:b}=o;const I=r[S];n.value.push(I),f.value.set(I.value,b)})});function _(r){return f.value.get(r.value)}return{filteredItems:n,filteredMatches:f,getMatches:_}}function mt(t,l,e){if(l==null)return t;if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return typeof l=="number"&&~l?a(Y,null,[a("span",{class:"v-autocomplete__unmask"},[t.substr(0,l)]),a("span",{class:"v-autocomplete__mask"},[t.substr(l,e)]),a("span",{class:"v-autocomplete__unmask"},[t.substr(l+e)])]):t}const vt=Qe()({name:"VAutocomplete",props:{search:String,...ct({filterKeys:["title"]}),...Ae(),...Ye(Le({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...tt({transition:!1})},emits:{"update:focused":t=>!0,"update:search":t=>!0,"update:modelValue":t=>!0,"update:menu":t=>!0},setup(t,l){let{slots:e}=l;const{t:c}=Ze(),i=B(),n=B(!1),f=B(!0),_=B(),r=ne(t,"menu"),d=L({get:()=>r.value,set:s=>{var m;r.value&&!s&&((m=_.value)!=null&&m.Î¨openChildren)||(r.value=s)}}),o=B(-1),S=L(()=>{var s;return(s=i.value)==null?void 0:s.color}),{items:b,transformIn:I,transformOut:K}=Je(t),{textColorClasses:te,textColorStyles:T}=lt(S),k=ne(t,"search",""),p=ne(t,"modelValue",[],s=>I(ke(s)),s=>{const m=K(s);return t.multiple?m:m[0]??null}),D=Oe(),{filteredItems:le,getMatches:ye}=ft(t,b,L(()=>f.value?void 0:k.value)),A=L(()=>p.value.map(s=>b.value.find(m=>t.valueComparator(m.value,s.value))||s)),ae=L(()=>t.hideSelected?le.value.filter(s=>!A.value.some(m=>m.value===s.value)):le.value),se=L(()=>A.value.map(s=>s.props.value)),fe=L(()=>A.value[o.value]),ie=B();function Ve(s){t.openOnClear&&(d.value=!0),k.value=""}function xe(){t.hideNoData&&!b.value.length||t.readonly||D!=null&&D.isReadonly.value||(d.value=!0)}function Fe(s){var Z,v,x,P;if(t.readonly||D!=null&&D.isReadonly.value)return;const m=i.value.selectionStart,y=se.value.length;if((o.value>-1||["Enter","ArrowDown","ArrowUp"].includes(s.key))&&s.preventDefault(),["Enter","ArrowDown"].includes(s.key)&&(d.value=!0),["Escape"].includes(s.key)&&(d.value=!1),["Enter","Escape","Tab"].includes(s.key)&&(f.value=!0),s.key==="ArrowDown"?(Z=ie.value)==null||Z.focus("next"):s.key==="ArrowUp"&&((v=ie.value)==null||v.focus("prev")),!!t.multiple){if(["Backspace","Delete"].includes(s.key)){if(o.value<0){s.key==="Backspace"&&!k.value&&(o.value=y-1);return}const g=o.value;fe.value&&j(fe.value),o.value=g>=y-1?y-2:g}if(s.key==="ArrowLeft"){if(o.value<0&&m>0)return;const g=o.value>-1?o.value-1:y-1;A.value[g]?o.value=g:(o.value=-1,i.value.setSelectionRange((x=k.value)==null?void 0:x.length,(P=k.value)==null?void 0:P.length))}if(s.key==="ArrowRight"){if(o.value<0)return;const g=o.value+1;A.value[g]?o.value=g:(o.value=-1,i.value.setSelectionRange(0,0))}}}function Ce(s){k.value=s.target.value}function we(){n.value&&(f.value=!0)}function Be(s){n.value=!0}function Se(s){var m;s.relatedTarget==null&&((m=i.value)==null||m.focus())}const U=B(!1);function j(s){if(t.multiple){const m=se.value.findIndex(y=>t.valueComparator(y,s.value));if(m===-1)p.value=[...p.value,s];else{const y=[...p.value];y.splice(m,1),p.value=y}}else p.value=[s],U.value=!0,e.selection||(k.value=s.title),d.value=!1,f.value=!0,he(()=>U.value=!1)}return ge(n,s=>{var m;s?(U.value=!0,k.value=t.multiple||e.selection?"":String(((m=A.value.at(-1))==null?void 0:m.props.title)??""),f.value=!0,he(()=>U.value=!1)):(d.value=!1,k.value="")}),ge(k,s=>{!n.value||U.value||(s&&(d.value=!0),f.value=!s)}),Ge(()=>{const s=!!(t.chips||e.chip),m=!!(!t.hideNoData||ae.value.length||e.prepend||e.append||e["no-data"]),y=p.value.length>0,[Z]=ue.filterProps(t);return a(ue,N({ref:i},Z,{modelValue:k.value,"onUpdate:modelValue":v=>{v==null&&(p.value=[])},focused:n.value,"onUpdate:focused":v=>n.value=v,validationValue:p.externalValue,dirty:y,onInput:Ce,class:["v-autocomplete",{"v-autocomplete--active-menu":d.value,"v-autocomplete--chips":!!t.chips,"v-autocomplete--selecting-index":o.value>-1,[`v-autocomplete--${t.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!e.selection},t.class],style:t.style,appendInnerIcon:t.menuIcon,readonly:t.readonly,placeholder:y?void 0:t.placeholder,"onClick:clear":Ve,"onMousedown:control":xe,onKeydown:Fe}),{...e,default:()=>a(Y,null,[a(Re,N({ref:_,modelValue:d.value,"onUpdate:modelValue":v=>d.value=v,activator:"parent",contentClass:"v-autocomplete__content",eager:t.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:t.transition,onAfterLeave:we},t.menuProps),{default:()=>[m&&a(We,{ref:ie,selected:se.value,selectStrategy:t.multiple?"independent":"single-independent",onMousedown:v=>v.preventDefault(),onFocusin:Be,onFocusout:Se},{default:()=>{var v,x,P;return[!ae.value.length&&!t.hideNoData&&(((v=e["no-data"])==null?void 0:v.call(e))??a($,{title:c(t.noDataText)},null)),(x=e["prepend-item"])==null?void 0:x.call(e),ae.value.map(g=>{var E;return((E=e.item)==null?void 0:E.call(e,{item:g,props:N(g.props,{onClick:()=>j(g)})}))??a($,N({key:g.value},g.props,{onClick:()=>j(g)}),{prepend:w=>{let{isSelected:G}=w;return t.multiple&&!t.hideSelected?a(Me,{modelValue:G,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var w,G;return f.value?g.title:mt(g.title,(w=ye(g))==null?void 0:w.title,((G=k.value)==null?void 0:G.length)??0)}})}),(P=e["append-item"])==null?void 0:P.call(e)]}})]}),A.value.map((v,x)=>{var E;function P(w){w.stopPropagation(),w.preventDefault(),j(v)}const g={"onClick:close":P,modelValue:!0,"onUpdate:modelValue":void 0};return a("div",{key:v.value,class:["v-autocomplete__selection",x===o.value&&["v-autocomplete__selection--selected",te.value]],style:x===o.value?T.value:{}},[s?e.chip?a(at,{key:"chip-defaults",defaults:{VChip:{closable:t.closableChips,size:"small",text:v.title}}},{default:()=>{var w;return[(w=e.chip)==null?void 0:w.call(e,{item:v,index:x,props:g})]}}):a(q,N({key:"chip",closable:t.closableChips,size:"small",text:v.title},g),null):((E=e.selection)==null?void 0:E.call(e,{item:v,index:x}))??a("span",{class:"v-autocomplete__selection-text"},[v.title,t.multiple&&x<A.value.length-1&&a("span",{class:"v-autocomplete__selection-comma"},[V(",")])])])})])})}),Xe({isFocused:n,isPristine:f,menu:d,search:k,filteredItems:le,select:j},i)}}),gt={components:{StatusChip:pe},props:{defaultStatuses:{type:Array,default:J.map(t=>t.value)}},data(){return{loading:!1,textFilter:"",statuses:J,activeStatuses:null,statusFilter:[],registers:[],registerFilter:[],expanded:!1,noAnimate:!0,tags:null,tagFilter:[]}},mounted(){this.loading=!0,re.config.showImported&&Q.getRegisters(!0).then(t=>{Object.keys(t).length>1?(this.registers=Object.values(t).filter(Q.isShown).sort((l,e)=>l.local!==e.local?l.local?-1:1:l.name.localeCompare(e.name)).map(l=>({name:l.name,url:l.url,color:l.color})),this.registerFilter=this.registers.map(l=>l.url)):(this.registers=[],this.registerFilter=null)}),Q.getBBlocks(re.config.showImported).then(t=>{const l=new Set,e={};Object.values(t).forEach(c=>{var i;l.add(c.status),(i=c.tags)==null||i.forEach(n=>{n=n.trim().toLowerCase(),e[n]=e[n]?e[n]+1:1})}),this.tags=Object.keys(e).sort(),this.activeStatuses=J.filter(c=>l.has(c.value)),this.defaultStatuses&&(this.statusFilter=this.defaultStatuses.filter(c=>l.has(c)))}).finally(()=>this.loading=!1),this.expanded=this.$vuetify.display.mdAndUp?"expanded":null,setTimeout(()=>this.noAnimate=!1,350),this.debouncedTextFilter=Ue(t=>{this.emitFilter()},300),this.emitFilter()},methods:{selectAllStatuses(){this.statusFilter=J.map(t=>t.value)},selectOnlyStable(){this.statusFilter=["stable"]},selectRegisters(t){t?this.registerFilter=this.registers.map(l=>l.url):this.registerFilter.length=0},reset(){this.textFilter="",this.statusFilter=this.defaultStatuses.slice(),this.selectRegisters(!0)},emitFilter(){this.$emit("filter-change",{text:this.textFilter,registers:this.registers.length?this.registerFilter:null,status:this.statusFilter,tags:this.tagFilter})}},watch:{registerFilter(){this.emitFilter()},statusFilter(){this.emitFilter()},textFilter(t){this.debouncedTextFilter(t)},tagFilter(){this.emitFilter()},defaultStatuses(){this.statusFilter=this.defaultStatuses.slice()}}},ht={class:"flex-grow-1 mx-2 filter-text mb-1"},_t={key:0,class:"mx-2 filter-status mb-1"},kt={key:1,class:"mx-2 filter-registers mb-1"},bt={key:2,class:"mx-2 filter-tags mb-1"},pt={class:"mx-2 d-flex align-center filter-reset"};function yt(t,l,e,c,i,n){const f=X("status-chip");return h(),F(De,{modelValue:i.expanded,"onUpdate:modelValue":l[6]||(l[6]=_=>i.expanded=_),class:_e({"no-animate":i.noAnimate})},{default:u(()=>[a(Te,{title:"Filters",value:"expanded",eager:""},{default:u(()=>[a(Pe,null,{default:u(()=>{var _;return[C("div",{class:_e(["d-flex flex-wrap filter-wrapper justify-end",t.$vuetify.display.mdAndUp?"size-md":""])},[C("div",ht,[a(ue,{label:"Name or identifier",modelValue:i.textFilter,"onUpdate:modelValue":l[0]||(l[0]=r=>i.textFilter=r),"hide-details":"auto",clearable:""},null,8,["modelValue"])]),i.activeStatuses?(h(),M("div",_t,[a(me,{label:"Status","item-title":"label",items:i.activeStatuses,multiple:"",modelValue:i.statusFilter,"onUpdate:modelValue":l[1]||(l[1]=r=>i.statusFilter=r),"hide-details":"auto"},{"prepend-item":u(()=>[a($,{class:"all-none"},{default:u(()=>[a(z,{variant:"text",onClick:n.selectAllStatuses},{default:u(()=>[V("All")]),_:1},8,["onClick"]),a(z,{variant:"text",onClick:n.selectOnlyStable},{default:u(()=>[V("Only stable")]),_:1},8,["onClick"])]),_:1})]),selection:u(({item:r})=>[a(f,{status:r.value,class:"mb-1"},null,8,["status"])]),_:1},8,["items","modelValue"])])):R("",!0),i.registers.length>1?(h(),M("div",kt,[a(me,{label:"Registers",items:i.registers,multiple:"",modelValue:i.registerFilter,"onUpdate:modelValue":l[4]||(l[4]=r=>i.registerFilter=r),"item-title":"name","item-value":"url","hide-details":"auto"},{"prepend-item":u(()=>[a($,{class:"all-none"},{default:u(()=>[a(z,{variant:"text",onClick:l[2]||(l[2]=r=>n.selectRegisters(!0))},{default:u(()=>[V("All")]),_:1}),a(z,{variant:"text",onClick:l[3]||(l[3]=r=>n.selectRegisters(!1))},{default:u(()=>[V("None")]),_:1})]),_:1})]),selection:u(({item:r})=>[r.raw?(h(),F(q,{key:0,size:"small",variant:"flat",color:r.raw.color,class:"mb-1"},{default:u(()=>[V(O(r.title),1)]),_:2},1032,["color"])):R("",!0)]),_:1},8,["items","modelValue"])])):R("",!0),(_=i.tags)!=null&&_.length?(h(),M("div",bt,[a(vt,{label:"Tags",items:i.tags,multiple:"",modelValue:i.tagFilter,"onUpdate:modelValue":l[5]||(l[5]=r=>i.tagFilter=r),"hide-details":"auto",clearable:""},null,8,["items","modelValue"])])):R("",!0),a(ce),C("div",pt,[a(ce),a(z,{onClick:n.reset,block:t.$vuetify.display.smAndDown},{default:u(()=>[V("Reset")]),_:1},8,["onClick","block"])])],2)]}),_:1})]),_:1})]),_:1},8,["modelValue","class"])}const Vt=ee(gt,[["render",yt]]),xt={components:{StatusChip:pe},props:{bblock:{type:Object,required:!0}},methods:{trim(t,l,e="â¦"){return!t||t.length<=l?t:`${t.substr(0,l-1)}${e}`}}},Ft={class:"abstract"},Ct={class:"bblock-bottom mb-2 ml-2"},wt={key:0,class:"tags mb-2 ml-2"},Bt=C("span",{class:"tags-title mr-1 mb-1 text-caption"},"Tags:",-1),St=["textContent"];function It(t,l,e,c,i,n){const f=X("status-chip");return h(),F(be,{class:"fill-height d-flex flex-column building-block"},{default:u(()=>{var _;return[a(de,{class:"d-flex pb-0 bblock-name"},{default:u(()=>[C("div",null,[V(O(e.bblock.name)+" ",1),C("small",null,"v"+O(e.bblock.version),1)]),a(ce),a(f,{status:e.bblock.status},null,8,["status"])]),_:1}),a(st,{class:"text-caption"},{default:u(()=>[C("code",null,O(e.bblock.itemIdentifier),1)]),_:1}),a(it,null,{default:u(()=>[C("div",Ft,O(n.trim(e.bblock.abstract,200)),1)]),_:1}),C("div",Ct,[(_=e.bblock.tags)!=null&&_.length?(h(),M("div",wt,[Bt,(h(!0),M(Y,null,oe(e.bblock.tags,r=>(h(),M("span",{class:"tag mr-1 mb-1 text-caption",textContent:O(r)},null,8,St))),256))])):R("",!0),C("div",null,[a(q,{variant:"flat",color:e.bblock.register.color,title:e.bblock.register.url},{default:u(()=>[V(O(e.bblock.register.name),1)]),_:1},8,["color","title"])])])]}),_:1})}const At=ee(xt,[["render",It]]);const Lt={components:{BuildingBlockListItem:At,BuildingBlockFilters:Vt,RegisterLoadingProgress:Ee,BuildingBlock:Ke},data(){return{loading:!1,buildingBlocks:null,bblockDialog:!1,bblockView:null,registerProgress:{completed:0,total:0},showRegisterLoadingProgress:!1,filterValues:null}},mounted(){this.loading=!0,Q.getBBlocks(re.config.showImported).then(t=>{this.buildingBlocks=Object.values(t).filter(Q.isShown).sort((l,e)=>{const c=l.itemIdentifier.toLowerCase(),i=e.itemIdentifier.toLowerCase();return c<i?-1:c>i?1:0})}).finally(()=>{this.loading=!1})},methods:{interceptLinks:je,openUrl(t){window.open(t)},isVisible(t){var l,e;if(this.filterValues.text){const c=this.filterValues.text.trim().toLowerCase();if(t.itemIdentifier.toLowerCase().indexOf(c)<0&&t.name.toLowerCase().indexOf(c)<0)return!1}return!(!this.filterValues.status.includes(t.status)||this.filterValues.registers!==null&&!this.filterValues.registers.includes(t.register.url)||(l=this.filterValues.tags)!=null&&l.length&&!((e=t.tags)!=null&&e.some(c=>this.filterValues.tags.includes(c))))}},computed:{filteredBuildingBlocks(){if(!this.filterValues||!this.buildingBlocks)return[];const t=[],l=[];return this.buildingBlocks.forEach(e=>{this.isVisible(e)&&(e.highlighted?t:l).push(e)}),{highlighted:t,nonHighlighted:l}}}},Ot=C("h2",null,"Highlighted Building Blocks",-1);function Rt(t,l,e,c,i,n){const f=X("building-block-filters"),_=X("building-block-list-item");return h(),F(nt,{class:"bblock-list"},{default:u(()=>{var r,d;return[a(W,null,{default:u(()=>[a(H,null,{default:u(()=>[a(f,{onFilterChange:l[0]||(l[0]=o=>this.filterValues=o)})]),_:1})]),_:1}),(d=(r=n.filteredBuildingBlocks)==null?void 0:r.highlighted)!=null&&d.length?(h(),F(W,{key:0,align:"stretch"},{default:u(()=>[a(H,{cols:"12"},{default:u(()=>[Ot]),_:1}),(h(!0),M(Y,null,oe(n.filteredBuildingBlocks.highlighted,o=>(h(),F(H,{key:o.itemIdentifier,md:"6"},{default:u(()=>[a(_,{bblock:o,to:{name:"BuildingBlock",params:{id:o.itemIdentifier}},class:"highlighted-bblock"},null,8,["bblock","to"])]),_:2},1024))),128)),a($e)]),_:1})):R("",!0),a(W,{align:"stretch"},{default:u(()=>[(h(!0),M(Y,null,oe(n.filteredBuildingBlocks.nonHighlighted,o=>(h(),F(H,{key:o.itemIdentifier,md:"6"},{default:u(()=>[a(_,{bblock:o,to:{name:"BuildingBlock",params:{id:o.itemIdentifier}}},null,8,["bblock","to"])]),_:2},1024))),128))]),_:1}),i.buildingBlocks&&!n.filteredBuildingBlocks.nonHighlighted.length&&!n.filteredBuildingBlocks.highlighted.length?(h(),F(W,{key:1},{default:u(()=>[a(H,null,{default:u(()=>[a(be,null,{default:u(()=>[i.buildingBlocks.length?(h(),F(de,{key:0},{default:u(()=>[V("No building blocks match the current filters")]),_:1})):(h(),F(de,{key:1},{default:u(()=>[V("No building blocks were found in the register.")]),_:1}))]),_:1})]),_:1})]),_:1})):R("",!0),a(et,{"model-value":i.loading,class:"align-center justify-center"},{default:u(()=>[a(qe,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"])]}),_:1})}const Ht=ee(Lt,[["render",Rt]]);export{Ht as default};
