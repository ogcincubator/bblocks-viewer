import{_ as ae,c as fe,b as W,d as Te}from"./index.js";import{s as Re,V as N,u as je,a as me,m as De,b as Ke,c as Ue,d as ze,e as $,i as Ee,f as Ne,g as He,h as Je,j as ce,k as Ce}from"./VExpansionPanel.js";import{c as w,l as C,w as i,o as d,q as k,t as y,y as Ve,A,z as M,a4 as Qe,a5 as he,a6 as Fe,a7 as Xe,I as Ge,a8 as We,J as de,C as be,X as pe,M as Ye,p as a,N as G,a9 as Ze,F as D,aa as te,r as E,n as m,k as V,x as le,ab as ke,ac as ye}from"./vendor.js";import{h as qe,i as $e,b as et,c as Y,a as O,d as se,j as tt,k as lt,g as st,V as at}from"./VList.js";import{q as it,r as nt,o as ee,s as rt,a as ge,p as ve,n as ut,b as we,l as ot}from"./VContainer.js";import{V as xe}from"./VTooltip.js";import{V as z,a as j}from"./VRow.js";import"./dialog-transition.js";const ct={props:{status:String,variant:{type:String,default:"flat"},size:{type:String,default:"small"}},computed:{color(){return Re[this.status]||null},label(){return this.status.charAt(0).toUpperCase()+this.status.substring(1).replaceAll("-"," ")}}};function dt(e,l,t,f,s,u){return t.status?(d(),w(N,{key:0,variant:t.variant,color:u.color,size:t.size},{default:i(()=>[k(y(u.label),1)]),_:1},8,["variant","color","size"])):C("",!0)}const Be=ae(ct,[["render",dt]]),ft=(e,l,t)=>e==null||l==null?-1:e.toString().toLocaleLowerCase().indexOf(l.toString().toLocaleLowerCase()),mt=Ve({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ht(e,l,t){var v;const f=[],s=(t==null?void 0:t.default)??ft,u=t!=null&&t.filterKeys?Fe(t.filterKeys):!1,o=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return f;e:for(let h=0;h<e.length;h++){const n=e[h],c={},g={};let _=-1;if(l&&!(t!=null&&t.noFilter)){if(typeof n=="object"){const ie=u||Object.keys(n);for(const K of ie){const F=Xe(n,K,n),B=(v=t==null?void 0:t.customKeyFilter)==null?void 0:v[K];if(_=B?B(F,l,n):s(F,l,n),_!==-1&&_!==!1)B?c[K]=_:g[K]=_;else if((t==null?void 0:t.filterMode)==="every")continue e}}else _=s(n,l,n),_!==-1&&_!==!1&&(g.title=_);const P=Object.keys(g).length,H=Object.keys(c).length;if(!P&&!H||(t==null?void 0:t.filterMode)==="union"&&H!==o&&!P||(t==null?void 0:t.filterMode)==="intersection"&&(H!==o||!P))continue}f.push({index:h,matches:{...g,...c}})}return f}function vt(e,l,t,f){const s=A(()=>typeof(t==null?void 0:t.value)!="string"&&typeof(t==null?void 0:t.value)!="number"?"":String(t.value)),u=M([]),o=M(new Map);Qe(()=>{u.value=[],o.value=new Map;const h=he(l);ht(h,s.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:he(f==null?void 0:f.filterKeys)??e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).forEach(c=>{let{index:g,matches:_}=c;const P=h[g];u.value.push(P),o.value.set(P.value,_)})});function v(h){return o.value.get(h.value)}return{filteredItems:u,filteredMatches:o,getMatches:v}}function gt(e,l,t){if(l==null)return e;if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return typeof l=="number"&&~l?a(D,null,[a("span",{class:"v-autocomplete__unmask"},[e.substr(0,l)]),a("span",{class:"v-autocomplete__mask"},[e.substr(l,t)]),a("span",{class:"v-autocomplete__unmask"},[e.substr(l+t)])]):e}const _t=Ve({search:String,...mt({filterKeys:["title"]}),...De(),...Ze(Ke({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...nt({transition:!1})},"v-autocomplete"),bt=Ge()({name:"VAutocomplete",props:_t(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,l){let{slots:t}=l;const{t:f}=We(),s=M(),u=M(!1),o=M(!0),v=M(),h=de(e,"menu"),n=A({get:()=>h.value,set:r=>{var x;h.value&&!r&&((x=v.value)!=null&&x.ΨopenChildren)||(h.value=r)}}),c=M(-1),g=A(()=>{var r;return(r=s.value)==null?void 0:r.color}),{items:_,transformIn:P,transformOut:H}=qe(e),{textColorClasses:ie,textColorStyles:K}=it(g),F=de(e,"search",""),B=de(e,"modelValue",[],r=>P(Fe(r)),r=>{const x=H(r);return e.multiple?x:x[0]??null}),U=je(),{filteredItems:ne,getMatches:Ie}=vt(e,_,A(()=>o.value?void 0:F.value)),T=A(()=>B.value.map(r=>_.value.find(x=>e.valueComparator(x.value,r.value))||r)),re=A(()=>e.hideSelected?ne.value.filter(r=>!T.value.some(x=>x.value===r.value)):ne.value),ue=A(()=>T.value.map(r=>r.props.value)),_e=A(()=>T.value[c.value]),oe=M();function Se(r){e.openOnClear&&(n.value=!0),F.value=""}function Ae(){e.hideNoData&&!_.value.length||e.readonly||U!=null&&U.isReadonly.value||(n.value=!0)}function Le(r){var Z,p,L,R;if(e.readonly||U!=null&&U.isReadonly.value)return;const x=s.value.selectionStart,S=ue.value.length;if((c.value>-1||["Enter","ArrowDown","ArrowUp"].includes(r.key))&&r.preventDefault(),["Enter","ArrowDown"].includes(r.key)&&(n.value=!0),["Escape"].includes(r.key)&&(n.value=!1),["Enter","Escape","Tab"].includes(r.key)&&(o.value=!0),r.key==="ArrowDown"?(Z=oe.value)==null||Z.focus("next"):r.key==="ArrowUp"&&((p=oe.value)==null||p.focus("prev")),!!e.multiple){if(["Backspace","Delete"].includes(r.key)){if(c.value<0){r.key==="Backspace"&&!F.value&&(c.value=S-1);return}const b=c.value;_e.value&&Q(_e.value),c.value=b>=S-1?S-2:b}if(r.key==="ArrowLeft"){if(c.value<0&&x>0)return;const b=c.value>-1?c.value-1:S-1;T.value[b]?c.value=b:(c.value=-1,s.value.setSelectionRange((L=F.value)==null?void 0:L.length,(R=F.value)==null?void 0:R.length))}if(r.key==="ArrowRight"){if(c.value<0)return;const b=c.value+1;T.value[b]?c.value=b:(c.value=-1,s.value.setSelectionRange(0,0))}}}function Me(r){F.value=r.target.value}function Oe(){var r;u.value&&(o.value=!0,(r=s.value)==null||r.focus())}function Pe(r){u.value=!0}const J=M(!1);function Q(r){if(e.multiple){const x=ue.value.findIndex(S=>e.valueComparator(S,r.value));if(x===-1)B.value=[...B.value,r];else{const S=[...B.value];S.splice(x,1),B.value=S}}else B.value=[r],J.value=!0,F.value=r.title,n.value=!1,o.value=!0,pe(()=>J.value=!1)}return be(u,r=>{var x;r?(J.value=!0,F.value=e.multiple?"":String(((x=T.value.at(-1))==null?void 0:x.props.title)??""),o.value=!0,pe(()=>J.value=!1)):(!e.multiple&&!F.value&&(B.value=[]),n.value=!1,F.value="",c.value=-1)}),be(F,r=>{!u.value||J.value||(r&&(n.value=!0),o.value=!r)}),Ye(()=>{const r=!!(e.chips||t.chip),x=!!(!e.hideNoData||re.value.length||t.prepend||t.append||t["no-data"]),S=B.value.length>0,[Z]=me.filterProps(e);return a(me,G({ref:s},Z,{modelValue:F.value,"onUpdate:modelValue":p=>{p==null&&(B.value=[])},focused:u.value,"onUpdate:focused":p=>u.value=p,validationValue:B.externalValue,dirty:S,onInput:Me,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":n.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selecting-index":c.value>-1},e.class],style:e.style,appendInnerIcon:e.menuIcon,readonly:e.readonly,placeholder:S?void 0:e.placeholder,"onClick:clear":Se,"onMousedown:control":Ae,onKeydown:Le}),{...t,default:()=>a(D,null,[a(Ue,G({ref:v,modelValue:n.value,"onUpdate:modelValue":p=>n.value=p,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:Oe},e.menuProps),{default:()=>[x&&a(et,{ref:oe,selected:ue.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:p=>p.preventDefault(),onFocusin:Pe},{default:()=>{var p,L,R;return[!re.value.length&&!e.hideNoData&&(((p=t["no-data"])==null?void 0:p.call(t))??a(Y,{title:f(e.noDataText)},null)),(L=t["prepend-item"])==null?void 0:L.call(t),re.value.map(b=>{var X;return((X=t.item)==null?void 0:X.call(t,{item:b,props:G(b.props,{onClick:()=>Q(b)})}))??a(Y,G({key:b.value},b.props,{onClick:()=>Q(b)}),{prepend:I=>{let{isSelected:q}=I;return a(D,null,[e.multiple&&!e.hideSelected?a(ze,{modelValue:q,ripple:!1,tabindex:"-1"},null):void 0,b.props.prependIcon&&a(ee,{icon:b.props.prependIcon},null)])},title:()=>{var I,q;return o.value?b.title:gt(b.title,(I=Ie(b))==null?void 0:I.title,((q=F.value)==null?void 0:q.length)??0)}})}),(R=t["append-item"])==null?void 0:R.call(t)]}})]}),T.value.map((p,L)=>{var X;function R(I){I.stopPropagation(),I.preventDefault(),Q(p)}const b={"onClick:close":R,onMousedown(I){I.preventDefault(),I.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0};return a("div",{key:p.value,class:["v-autocomplete__selection",L===c.value&&["v-autocomplete__selection--selected",ie.value]],style:L===c.value?K.value:{}},[r?t.chip?a(rt,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:p.title}}},{default:()=>{var I;return[(I=t.chip)==null?void 0:I.call(t,{item:p,index:L,props:b})]}}):a(N,G({key:"chip",closable:e.closableChips,size:"small",text:p.title},b),null):((X=t.selection)==null?void 0:X.call(t,{item:p,index:L}))??a("span",{class:"v-autocomplete__selection-text"},[p.title,e.multiple&&L<T.value.length-1&&a("span",{class:"v-autocomplete__selection-comma"},[k(",")])])])})])})}),$e({isFocused:u,isPristine:o,menu:n,search:F,filteredItems:ne,select:Q},s)}}),pt={components:{StatusChip:Be},props:{defaultStatuses:{type:Array,default:$.map(e=>e.value)}},data(){return{loading:!1,textFilter:"",statuses:$,activeStatuses:null,statusFilter:[],registers:[],registerFilter:[],expanded:!1,noAnimate:!0,tags:null,tagFilter:[],itemClasses:[],itemClassFilter:[]}},mounted(){this.loading=!0,fe.config.showImported&&W.getRegisters(!0).then(e=>{Object.keys(e).length>1?(this.registers=Object.values(e).filter(W.isShown).sort((l,t)=>l.local!==t.local?l.local?-1:1:l.name.localeCompare(t.name)).map(l=>({name:l.name,url:l.url,color:l.color})),this.registerFilter=this.registers.map(l=>l.url)):(this.registers=[],this.registerFilter=null)}),W.getBBlocks(fe.config.showImported).then(e=>{const l=new Set,t={},f=new Set;Object.values(e).forEach(s=>{var u;l.add(s.status),f.add(s.itemClass),(u=s.tags)==null||u.forEach(o=>{o=o.trim().toLowerCase(),t[o]=t[o]?t[o]+1:1})}),this.tags=Object.keys(t).sort(),this.activeStatuses=$.filter(s=>l.has(s.value)),this.defaultStatuses&&(this.statusFilter=this.defaultStatuses.filter(s=>l.has(s))),this.itemClasses=Ee.filter(s=>f.has(s.value)),this.selectItemClasses(!0)}).finally(()=>this.loading=!1),this.expanded=this.$vuetify.display.mdAndUp?"expanded":null,setTimeout(()=>this.noAnimate=!1,350),this.debouncedTextFilter=Te(e=>{this.emitFilter()},300),this.emitFilter()},methods:{selectAllStatuses(){this.statusFilter=$.map(e=>e.value)},selectOnlyStable(){this.statusFilter=["stable"]},selectRegisters(e){e?this.registerFilter=this.registers.map(l=>l.url):this.registerFilter.length=0},selectItemClasses(e){e?this.itemClassFilter=this.itemClasses.map(l=>l.value):this.itemClassFilter.length=0},reset(){this.textFilter="",this.statusFilter=this.defaultStatuses.slice(),this.selectRegisters(!0)},emitFilter(){this.$emit("filter-change",{text:this.textFilter,registers:this.registers.length?this.registerFilter:null,status:this.statusFilter,tags:this.tagFilter,itemClasses:this.itemClassFilter})}},computed:{immediateFilters(){return[this.registerFilter,this.statusFilter,this.tagFilter,this.itemClassFilter]}},watch:{immediateFilters(){this.emitFilter()},textFilter(e){this.debouncedTextFilter(e)}}},kt={class:"flex-grow-1 mx-1 filter-text mb-1"},yt={key:0,class:"mx-1 filter-status mb-1"},xt={key:1,class:"text-grey text-caption align-self-center"},Ct={key:1,class:"mx-1 filter-registers mb-1"},Vt={key:0},Ft={key:2,class:"mx-1 filter-item-classes mb-1"},wt={key:1,class:"text-grey text-caption align-self-center"},Bt={key:3,class:"mx-1 filter-tags mb-1"},It={class:"mx-2 d-flex align-center filter-reset"};function St(e,l,t,f,s,u){const o=E("status-chip");return d(),w(Ne,{modelValue:s.expanded,"onUpdate:modelValue":l[9]||(l[9]=v=>s.expanded=v),class:te([{"no-animate":s.noAnimate},"building-block-filters"])},{default:i(()=>[a(He,{title:"Filters",value:"expanded",eager:""},{default:i(()=>[a(Je,null,{default:i(()=>{var v,h;return[m("div",{class:te(["d-flex flex-wrap filter-wrapper",e.$vuetify.display.mdAndUp?"size-md":""])},[m("div",kt,[a(me,{label:"Name or identifier",modelValue:s.textFilter,"onUpdate:modelValue":l[0]||(l[0]=n=>s.textFilter=n),"hide-details":"auto",clearable:""},null,8,["modelValue"])]),s.activeStatuses?(d(),V("div",yt,[a(ce,{label:"Status","item-title":"label",items:s.activeStatuses,multiple:"",modelValue:s.statusFilter,"onUpdate:modelValue":l[1]||(l[1]=n=>s.statusFilter=n),"hide-details":"auto"},{"prepend-item":i(()=>[a(Y,{class:"all-none"},{default:i(()=>[a(O,{variant:"text",onClick:u.selectAllStatuses},{default:i(()=>[k("All")]),_:1},8,["onClick"]),a(O,{variant:"text",onClick:u.selectOnlyStable},{default:i(()=>[k("Only stable")]),_:1},8,["onClick"])]),_:1})]),selection:i(({item:n,index:c})=>[c<2?(d(),w(o,{key:0,status:n.value,class:""},null,8,["status"])):C("",!0),c===2?(d(),V("span",xt," (+ "+y(s.statusFilter.length-2)+" others) ",1)):C("",!0)]),_:1},8,["items","modelValue"])])):C("",!0),s.registers.length>1?(d(),V("div",Ct,[a(ce,{label:"Registers",items:s.registers,multiple:"",modelValue:s.registerFilter,"onUpdate:modelValue":l[4]||(l[4]=n=>s.registerFilter=n),"item-title":"name","item-value":"url","hide-details":"auto"},{"prepend-item":i(()=>[a(Y,{class:"all-none"},{default:i(()=>[a(O,{variant:"text",onClick:l[2]||(l[2]=n=>u.selectRegisters(!0))},{default:i(()=>[k("All")]),_:1}),a(O,{variant:"text",onClick:l[3]||(l[3]=n=>u.selectRegisters(!1))},{default:i(()=>[k("None")]),_:1})]),_:1})]),selection:i(({index:n})=>[n===0?(d(),V("span",Vt,y(s.registerFilter.length)+" registers",1)):C("",!0)]),_:1},8,["items","modelValue"])])):C("",!0),((v=s.itemClasses)==null?void 0:v.length)>1?(d(),V("div",Ft,[a(ce,{label:"Item classes",items:s.itemClasses,multiple:"",modelValue:s.itemClassFilter,"onUpdate:modelValue":l[7]||(l[7]=n=>s.itemClassFilter=n),"hide-details":"auto","item-title":"label","item-value":"value"},{"prepend-item":i(()=>[a(Y,{class:"all-none"},{default:i(()=>[a(O,{variant:"text",onClick:l[5]||(l[5]=n=>u.selectItemClasses(!0))},{default:i(()=>[k("All")]),_:1}),a(O,{variant:"text",onClick:l[6]||(l[6]=n=>u.selectItemClasses(!1))},{default:i(()=>[k("None")]),_:1})]),_:1})]),selection:i(({item:n,index:c})=>[c<3?(d(),w(N,{key:0,size:"small",variant:"flat"},{default:i(()=>[k(y(n.title),1)]),_:2},1024)):C("",!0),c===3?(d(),V("span",wt," (+ "+y(s.statusFilter.length-3)+" others) ",1)):C("",!0)]),_:1},8,["items","modelValue"])])):C("",!0),(h=s.tags)!=null&&h.length?(d(),V("div",Bt,[a(bt,{label:"Tags",items:s.tags,multiple:"",modelValue:s.tagFilter,"onUpdate:modelValue":l[8]||(l[8]=n=>s.tagFilter=n),"hide-details":"auto",clearable:""},null,8,["items","modelValue"])])):C("",!0),a(se),m("div",It,[a(se),a(O,{onClick:u.reset,block:e.$vuetify.display.smAndDown},{default:i(()=>[k("Reset")]),_:1},8,["onClick","block"])])],2)]}),_:1})]),_:1})]),_:1},8,["modelValue","class"])}const At=ae(pt,[["render",St]]),Lt={components:{StatusChip:Be},props:{bblock:{type:Object,required:!0}},methods:{getItemClassLabel:Ce,trim(e,l,t="…"){return!e||e.length<=l?e:`${e.substr(0,l-1)}${t}`}}},Mt={class:"abstract"},Ot={class:"bblock-bottom mb-2 mx-2"},Pt={key:0,class:"tags mb-2 ml-2"},Tt=m("span",{class:"tags-title mr-1 mb-1 text-caption"},"Tags:",-1),Rt=["textContent"],jt={class:"d-flex flex-column flex-sm-row align-start"},Dt={class:"text-truncate"};function Kt(e,l,t,f,s,u){const o=E("status-chip");return d(),w(ge,{class:"fill-height d-flex flex-column building-block"},{default:i(()=>{var v;return[a(ve,{class:"d-flex pb-0 bblock-name flex-column flex-sm-row align-start"},{default:i(()=>[m("div",null,[k(y(t.bblock.name)+" ",1),m("small",null,"v"+y(t.bblock.version),1)]),a(se),m("div",null,[a(o,{class:"my-1 mt-sm-0",status:t.bblock.status},null,8,["status"])])]),_:1}),a(ut,{class:"text-caption",title:t.bblock.itemIdentifier},{default:i(()=>[m("code",null,y(t.bblock.itemIdentifier),1)]),_:1},8,["title"]),a(we,null,{default:i(()=>[m("div",Mt,y(u.trim(t.bblock.abstract,200)),1)]),_:1}),m("div",Ot,[(v=t.bblock.tags)!=null&&v.length?(d(),V("div",Pt,[Tt,(d(!0),V(D,null,le(t.bblock.tags,h=>(d(),V("span",{class:"tag mr-1 mb-1 text-caption",textContent:y(h),key:h},null,8,Rt))),128))])):C("",!0),m("div",jt,[m("div",null,[a(N,{variant:"flat",color:t.bblock.register.color,title:`${t.bblock.register.name}
${t.bblock.register.url}`},{default:i(()=>[m("span",Dt,y(t.bblock.register.name),1)]),_:1},8,["color","title"])]),a(se),m("div",null,[a(N,{color:"default",variant:"flat",class:"mt-2 mt-sm-0"},{default:i(()=>[k(y(u.getItemClassLabel(t.bblock.itemClass)),1)]),_:1})])])])]}),_:1})}const Ut=ae(Lt,[["render",Kt]]),zt={key:0,class:"d-flex"},Et={key:0},Nt={class:"d-flex"},Ht=m("span",{class:"flex-grow-1"},null,-1),Jt={class:"flex-grow-1"},Qt={key:0},Xt={class:"text-muted"},Gt={class:"abstract text-muted text-truncate"},Wt={class:"flex-grow-1"},Yt={__name:"BuildingBlocksTreeItem",props:{node:{type:Object,required:!0},path:{type:Array,required:!0}},setup(e){const l=e,t=A(()=>l.node.bblock?"mdi-puzzle":"mdi-folder"),f=A(()=>l.node.children?Object.keys(l.node.children).sort((u,o)=>u.toLowerCase().localeCompare(o.toLowerCase())):[]),s=A(()=>l.node.bblock);return(u,o)=>{var h,n,c,g;const v=E("building-blocks-tree-item",!0);return d(),V("div",{class:te({"ml-5":(h=l.path)==null?void 0:h.length,"my-2":(n=l.path)==null?void 0:n.length})},[(c=l.path)!=null&&c.length?(d(),V("div",zt,[((g=l.path)==null?void 0:g.length)>1?(d(),V("div",Et,[a(ee,{class:"mr-1"},{default:i(()=>[k("mdi-subdirectory-arrow-right")]),_:1})])):C("",!0),s.value?(d(),w(ge,{key:1,to:{name:"BuildingBlock",params:{id:s.value.itemIdentifier}}},{default:i(()=>[a(we,{class:"text-body-1 py-1 px-3"},{default:i(()=>[m("div",Nt,[a(ee,{class:"mr-1"},{default:i(()=>[k(y(t.value),1)]),_:1}),a(xe,{text:s.value.itemIdentifier},{activator:i(({props:_})=>[m("code",ke(ye(_)),y(l.path[l.path.length-1]),17)]),_:1},8,["text"]),Ht,m("div",null,[a(N,{color:"default",variant:"flat",size:"small"},{default:i(()=>[k(y(he(Ce)(s.value.itemClass)),1)]),_:1})])]),m("div",Jt,[s.value?(d(),V("div",Qt,[m("div",null,[k(y(s.value.name)+" ",1),m("small",Xt,"v"+y(s.value.version),1)]),m("small",Gt,y(s.value.abstract),1)])):C("",!0)])]),_:1})]),_:1},8,["to"])):(d(),V("div",{key:2,class:te(["d-flex",{bblock:s.value}])},[m("div",null,[a(ee,{class:"mr-1"},{default:i(()=>[k(y(t.value),1)]),_:1})]),m("div",Wt,[a(xe,{text:e.path.join(".")},{activator:i(({props:_})=>[m("code",ke(ye(_)),y(l.path[l.path.length-1]),17)]),_:1},8,["text"])])],2))])):C("",!0),(d(!0),V(D,null,le(f.value,_=>(d(),w(v,{key:_,path:[...l.path,_],node:l.node.children[_]},null,8,["path","node"]))),128))],2)}}},Zt={key:0,class:"building-blocks-tree"},qt={__name:"BuildingBlocksTree",props:{bblocks:{type:Array,required:!0}},setup(e){const l=e,t=A(()=>{if(!l.bblocks)return null;const f={children:{}};for(const s of l.bblocks){const u=s.itemIdentifier.split(".");let o=f;for(const v of u)Object.hasOwn(o.children,v)||(o.children[v]={children:{}}),o=o.children[v];o.bblock=s}return f});return(f,s)=>t.value?(d(),V("div",Zt,[a(Yt,{path:[],node:t.value},null,8,["node"])])):C("",!0)}},$t={components:{BuildingBlocksTree:qt,BuildingBlockListItem:Ut,BuildingBlockFilters:At},data(){return{loading:!1,buildingBlocks:null,bblockDialog:!1,bblockView:null,registerProgress:{completed:0,total:0},showRegisterLoadingProgress:!1,filterValues:null,displayMode:"list"}},mounted(){this.loading=!0,W.getBBlocks(fe.config.showImported).then(e=>{this.buildingBlocks=Object.values(e).filter(W.isShown).sort((l,t)=>{const f=l.itemIdentifier.toLowerCase(),s=t.itemIdentifier.toLowerCase();return f<s?-1:f>s?1:0})}).finally(()=>{this.loading=!1})},methods:{isVisible(e){var l,t;if(this.filterValues.text){const f=this.filterValues.text.trim().toLowerCase();if(e.itemIdentifier.toLowerCase().indexOf(f)<0&&e.name.toLowerCase().indexOf(f)<0)return!1}return!(!this.filterValues.status.includes(e.status)||this.filterValues.registers!==null&&!this.filterValues.registers.includes(e.register.url)||(l=this.filterValues.tags)!=null&&l.length&&!((t=e.tags)!=null&&t.some(f=>this.filterValues.tags.includes(f.toLowerCase())))||!this.filterValues.itemClasses.includes(e.itemClass))}},computed:{filteredBuildingBlocks(){const e=[],l=[];return this.filterValues&&this.buildingBlocks&&this.buildingBlocks.forEach(t=>{this.isVisible(t)&&(t.highlighted?e:l).push(t)}),{highlighted:e,nonHighlighted:l}},filteredBuildingBlocksList(){return[...this.filteredBuildingBlocks.highlighted,...this.filteredBuildingBlocks.nonHighlighted]}}},el=m("h2",null,"Highlighted Building Blocks",-1);function tl(e,l,t,f,s,u){const o=E("building-block-filters"),v=E("building-blocks-tree"),h=E("building-block-list-item");return d(),w(ot,{class:"bblock-list"},{default:i(()=>{var n,c;return[a(z,null,{default:i(()=>[a(j,null,{default:i(()=>[a(o,{onFilterChange:l[0]||(l[0]=g=>this.filterValues=g)})]),_:1})]),_:1}),a(z,null,{default:i(()=>[a(j,{cols:"12",class:"text-center text-md-right"},{default:i(()=>[a(tt,{modelValue:s.displayMode,"onUpdate:modelValue":l[1]||(l[1]=g=>s.displayMode=g),divided:"",mandatory:""},{default:i(()=>[a(O,{"prepend-icon":"mdi-view-list",value:"list"},{default:i(()=>[k("List")]),_:1}),a(O,{"prepend-icon":"mdi-file-tree",value:"tree"},{default:i(()=>[k("Tree")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s.displayMode==="tree"?(d(),w(z,{key:0},{default:i(()=>[a(j,{cols:"12"},{default:i(()=>[a(v,{bblocks:u.filteredBuildingBlocksList},null,8,["bblocks"])]),_:1})]),_:1})):C("",!0),s.displayMode==="list"&&((c=(n=u.filteredBuildingBlocks)==null?void 0:n.highlighted)!=null&&c.length)?(d(),w(z,{key:1,align:"stretch"},{default:i(()=>[a(j,{cols:"12"},{default:i(()=>[el]),_:1}),(d(!0),V(D,null,le(u.filteredBuildingBlocks.highlighted,g=>(d(),w(j,{key:g.itemIdentifier,md:"6"},{default:i(()=>[a(h,{bblock:g,to:{name:"BuildingBlock",params:{id:g.itemIdentifier}},class:"highlighted-bblock"},null,8,["bblock","to"])]),_:2},1024))),128)),a(lt)]),_:1})):C("",!0),s.displayMode==="list"?(d(),w(z,{key:2,align:"stretch"},{default:i(()=>[(d(!0),V(D,null,le(u.filteredBuildingBlocks.nonHighlighted,g=>(d(),w(j,{key:g.itemIdentifier,md:"6"},{default:i(()=>[a(h,{bblock:g,to:{name:"BuildingBlock",params:{id:g.itemIdentifier}}},null,8,["bblock","to"])]),_:2},1024))),128))]),_:1})):C("",!0),s.buildingBlocks&&!u.filteredBuildingBlocks.nonHighlighted.length&&!u.filteredBuildingBlocks.highlighted.length?(d(),w(z,{key:3},{default:i(()=>[a(j,null,{default:i(()=>[a(ge,null,{default:i(()=>[s.buildingBlocks.length?(d(),w(ve,{key:0},{default:i(()=>[k("No building blocks match the current filters")]),_:1})):(d(),w(ve,{key:1},{default:i(()=>[k("No building blocks were found in the register.")]),_:1}))]),_:1})]),_:1})]),_:1})):C("",!0),a(st,{"model-value":s.loading,class:"align-center justify-center"},{default:i(()=>[a(at,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"])]}),_:1})}const cl=ae($t,[["render",tl]]);export{cl as default};
